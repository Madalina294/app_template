<!-- Main Container -->
<div class="login-page-container">
  <!-- Login Form Section -->
  <div class="login-card" *ngIf="!authResponse?.mfaEnabled">
    <nz-spin
      [nzSpinning]="isSpinning"
      [nzSize]="'large'"
      nzTip="Signing in..."
      class="login-spinner"
    >
      <div class="card-header">
        <h1 class="login-title">Welcome Back</h1>
        <p class="login-subtitle">Sign in to your account</p>
      </div>

      <form
        nz-form
        [formGroup]="loginForm"
        (ngSubmit)="login()"
        class="login-form"
      >
        <nz-form-item>
          <nz-form-control
            nzHasFeedback
            nzErrorTip="Please enter a valid email address"
            [nzValidateStatus]="loginForm.controls['email']"
          >
            <input
              nz-input
              placeholder="Email address"
              id="email"
              formControlName="email"
              class="form-input"
            />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-control
            nzHasFeedback
            [nzErrorTip]="errorPass"
            [nzValidateStatus]="loginForm.controls['password']"
          >
            <input
              nz-input
              placeholder="Password"
              type="password"
              id="password"
              formControlName="password"
              class="form-input"
            />
            <ng-template style="margin-bottom: 10px" #errorPass let-control>
              <ng-container *ngIf="control.hasError('required')">
                Password is required
              </ng-container>
              <ng-container
                *ngIf="control.hasError('pattern')"
                style="margin-bottom: 10px"
              >
                Password must contain at least 8 characters with uppercase,
                lowercase, number and special character
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>

        <button
          nz-button
          class="login-button"
          [nzType]="'primary'"
          type="submit"
          [disabled]="loginForm.invalid"
        >
          Sign In
        </button>

        <div class="signup-link">
          Don't have an account? <a routerLink="/register">Create one</a>
        </div>
      </form>
    </nz-spin>
  </div>

  <!-- 2FA Verification Section -->
  <div class="login-card mfa-card" *ngIf="authResponse?.mfaEnabled">
    <div class="card-header">
      <h1 class="login-title">Two-Factor Authentication</h1>
      <p class="login-subtitle">Scan the QR code with your authenticator app</p>
    </div>

    <div class="qr-section">
      <div class="qr-code-container">
        <img
          [src]="authResponse?.secretImageUri"
          alt="QR Code"
          class="qr-code"
        />
      </div>
      <p class="qr-instructions">
        Scan this QR code with Google Authenticator, Authy, or any compatible
        TOTP app
      </p>
    </div>
    <nz-spin
      [nzSpinning]="isSpinning"
      [nzSize]="'large'"
      nzTip="Signing in..."
      class="login-spinner"
    >
      <form class="verification-form">
        <nz-form-item>
          <label class="verification-label"
            >Enter the 6-digit code from your app</label
          >
          <input
            nz-input
            type="text"
            placeholder="000000"
            [(ngModel)]="otpCode"
            name="otpCode"
            maxlength="6"
            class="verification-input"
          />
        </nz-form-item>

        <button
          nz-button
          [nzType]="'primary'"
          type="button"
          (click)="verifyCode()"
          [disabled]="otpCode.length !== 6"
          class="verify-button"
        >
          Verify & Continue
        </button>
      </form>
    </nz-spin>
  </div>
</div>
